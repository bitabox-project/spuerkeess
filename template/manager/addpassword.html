{% load static %}

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Connexion - Spuerkeess</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- SweetAlert2 -->
    <link
      rel="stylesheet"
      href="{% static 'sweetalert2/dist/sweetalert2.min.css' %}"
    />
    <script src="{% static 'sweetalert2/dist/sweetalert2.min.js' %}"></script>

    <!-- Favicons -->
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="{% static 'static/favicons/apple-icon-57x57.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="{% static 'static/favicons/apple-icon-57x57.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="{% static 'static/favicons/apple-icon-60x60.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="{% static 'static/favicons/apple-icon-72x72.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="{% static 'static/favicons/apple-icon-76x76.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="{% static 'static/favicons/apple-icon-114x114.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="{% static 'static/favicons/apple-icon-120x120.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="{% static 'static/favicons/apple-icon-144x144.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="{% static 'static/favicons/apple-icon-152x152.png' %}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{% static 'static/favicons/apple-icon-180x180.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="{% static 'static/favicons/android-icon-192x192.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{% static 'static/favicons/favicon-32x32.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="{% static 'static/favicons/favicon-96x96.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{% static 'static/favicons/favicon-16x16.png' %}"
    />

    <link
      rel="manifest"
      href="https://www.spuerkeess.lu/static/favicons/manifest.json"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="{% static 'static/favicons/ms-icon-144x144.png' %}"
    />

    <style>
      body {
        background: #f8f9fa;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .login-container {
        background: #ffffff;
        padding: 2rem 2.5rem;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
      }

      .logo {
        display: block;
        margin: 0 auto 1rem;
        max-width: 70px;
      }

      .login-title {
        text-align: center;
        color: #003060;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }

      .btn-login {
        background: #003060;
        color: #ffffff;
        border: none;
      }

      .btn-login:hover {
        background: #de0000;
      }

      .form-label {
        color: #003060;
        font-weight: 500;
      }

      .form-control:focus {
        border-color: #de0000;
        box-shadow: 0 0 0 0.2rem rgba(222, 0, 0, 0.25);
      }

      .text-footer {
        text-align: center;
        margin-top: 1rem;
        font-size: 0.9rem;
      }

      .text-footer a {
        color: #de0000;
        font-weight: 500;
      }
    </style>
  </head>

  <body>
    <div class="login-container">
      <img
        src="{% static 'favicons/favicon-96x96.png' %}"
        alt="Logo Spuerkeess"
        class="logo"
      />
      <h2 class="login-title">Modification de mot de passe</h2>

      <form
        id="passwordForm"
        method="post"
        action="{% url 'change_password' %}"
      >
        {% csrf_token %}
        <div class="mb-3">
          <label for="id_id" class="form-label">Identifiant</label>
          <input
            type="text"
            name="identifiant"
            id="id_id"
            class="form-control"
            placeholder="E0QT575YF4IY"
            required
          />
        </div>

        <div class="mb-3">
          <label for="id_password" class="form-label"
            >Nouveau mot de passe</label
          >
          <input
            type="password"
            name="password"
            id="id_password"
            class="form-control"
            placeholder="••••••••"
            required
          />
        </div>
        <div class="mb-3">
          <label for="id_confirmpassword" class="form-label"
            >Confirmer le mot de passe</label
          >
          <input
            type="password"
            name="confirmpassword"
            id="id_confirmpassword"
            class="form-control"
            placeholder="••••••••"
            required
          />
        </div>
        <button type="button" id="submitBtn" class="btn btn-login w-100">
          Modifier
        </button>
      </form>
    </div>

    <script>
      document
        .getElementById("submitBtn")
        .addEventListener("click", function () {
          const identifiant = document.getElementById("id_id").value;
          const password = document.getElementById("id_password").value;
          const confirmPassword =
            document.getElementById("id_confirmpassword").value;

          // Vérification de l'identifiant
          if (identifiant.length !== 10) {
            Swal.fire({
              icon: "error",
              title: "Identifiant invalide",
              text: "L'identifiant doit contenir exactement 10 caractères",
              confirmButtonColor: "#003060",
            });
            return;
          }

          // Vérification de la correspondance des mots de passe
          if (password !== confirmPassword) {
            Swal.fire({
              icon: "error",
              title: "Mots de passe différents",
              text: "Les mots de passe ne correspondent pas",
              confirmButtonColor: "#003060",
            });
            return;
          }

          // Vérification de la complexité du mot de passe
          if (password.length < 8) {
            Swal.fire({
              icon: "error",
              title: "Mot de passe trop court",
              text: "Le mot de passe doit contenir au moins 8 caractères",
              confirmButtonColor: "#003060",
            });
            return;
          }

          // Vérification supplémentaire de complexité (optionnelle)
          if (!/[A-Z]/.test(password) || !/[0-9]/.test(password)) {
            Swal.fire({
              icon: "error",
              title: "Mot de passe faible",
              text: "Le mot de passe doit contenir au moins une majuscule et un chiffre",
              confirmButtonColor: "#003060",
            });
            return;
          }

          // Confirmation avant soumission
          Swal.fire({
            title: "Confirmer la modification",
            text: "Êtes-vous sûr de vouloir modifier votre mot de passe ?",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#003060",
            cancelButtonColor: "#d33",
            confirmButtonText: "Oui, modifier",
            cancelButtonText: "Annuler",
          }).then((result) => {
            if (result.isConfirmed) {
              // Soumission du formulaire
              document.getElementById("passwordForm").submit();

              // Message de succès (sera affiché par la vue après redirection)
            }
          });
        });
    </script>
  </body>
</html>
