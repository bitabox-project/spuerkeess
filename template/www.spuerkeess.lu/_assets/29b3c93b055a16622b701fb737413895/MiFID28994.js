(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function i(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,i||"default");if("object"!=t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:i+""}function n(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,i(s.key),s)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}const r=function(e,t){var i=document.createElement(e),n=arguments.length>2?arguments[2]:"";return Array.isArray(n)?n.forEach(function(e){e.nodeType||(e=document.createTextNode(e)),i.appendChild(e)}):n instanceof Element||n instanceof HTMLDocument?i.appendChild(n):i.innerHTML=n,Object.keys(t).forEach(function(e){i.setAttribute(e,t[e])}),i},a={AJAX_FORM_REQUESTED:"ajax.form.requested",AJAX_FORM_SUBMIT:"ajax.form.submit",AJAX_FORM_RESPONDED:"ajax.form.responded",AJAX_FORM_NEO_REQUESTED:"ajax.form.neo.requested",AJAX_FORM_NEO_SUBMIT:"ajax.form.neo.submit",AJAX_FORM_NEO_RESPONDED:"ajax.form.neo.responded",AJAX_STEP_FORM_SUBMIT:"ajax.step.form.submit",AJAX_STEP_FORM_SUBMIT_RESULT:"ajax.step.form.submit.result",AJAX_STEP_FORM_NEXT:"ajax.step.form.next",AJAX_STEP_FORM_BACK:"ajax.step.form.back",AJAX_STEP_FORM_INIT:"ajax.step.form.init",AJAX_STEP_FORM_STEP_CHECKED:"ajax.step.form.step.checked",AJAX_STEP_FORM_STEP_ACTIVE:"ajax.step.form.step.active",AJAX_STEP_FORM_SUMMARY_VALUES:"ajax.step.form.summary.values",AJAX_STEP_FORM_NAVIGATION:"ajax.step.form.navigation",AJAX_STEP_FORM_DYNAMIC_DATA:"ajax.step.form.dynamic.data",AJAX_STEP_FORM_TRIGGER_MODAL:"ajax.step.form.trigger.modal",AJAX_STEP_FORM_DISABLED_BTN:"ajax.step.form.disabled.btn",AJAX_STEP_FORM_FIELD_VALIDATION:"ajax.step.form.field.validation",AJAX_STEP_FORM_RESET_INPUT_VALUE:"ajax.step.form.reset.input.value",AJAX_STEP_FORM_HIDE_INPUT:"ajax.step.form.hide.input",AJAX_STEP_FORM_SHOW_INPUT:"ajax.step.form.show.input",AJAX_STEP_FORM_BACK_POSITION_UPDATED:"ajax.step.form.back.position.updated",AJAX_STEP_FORM_NEXT_POSITION_UPDATED:"ajax.step.form.next.position.updated",AJAX_STEP_FORM_APPOINTMENT_SEARCH_AGENCY:"ajax.appointment.search.agency",FORM_ELEMENT_CHANGED:"form.element.changed",FORM_ELEMENT_INTERACTED:"form.element.interacted",FORM_ERROR:"form.error",FORM_SLIDER_REBUILT:"form.slider.rebuild",FORM_SLIDER_SET_VALUE:"form.slider.set.value",FORM_SLIDER_SET_INDEX:"form.slider.set.index",FORM_INPUT_REBUILT:"form.input.rebuild",FORM_SELECT_REBUILT:"form.select.rebuild",FORM_COLOR_CHANGED:"form.color.changed",FORM_COLOR_REBUILD:"form.color.rebuild",CAPTCHA_REFRESH:"captcha.refresh",SEARCH_OVERLAY_SHOW:"search.overlay.show",WINDOW_RESIZE:"window.resize",WINDOW_LOADED:"window.loaded",SWIPER_UPDATE:"swiper.update",MAP_LOADED:"map.loaded",ANALYTICS:"analytics",INPUT_AMOUNT_REMOVED:"input.amount.removed"};var o=function(){return s(function t(){e(this,t),this.attachScrollIndicator()},[{key:"attachScrollIndicator",value:function(){var e=this;$(".scrollable-table").each(function(t,i){var n=$(i);if(!n.hasClass("loaded")){n.addClass("loaded");var s=n.find(".table-responsive"),r=n.find(".scroll-indicator.gradient-left"),a=n.find(".scroll-indicator.gradient-right"),o=n.find(".table");e.toggleScrollIndicator(o.position().left,s.scrollWidth,r,a,s),s.scroll(function(t){e.toggleScrollIndicator(o.position().left,t.currentTarget.scrollWidth,r,a,s)})}})}},{key:"toggleScrollIndicator",value:function(e,t,i,n,s){e>=0?i.addClass("d-none"):i.removeClass("d-none"),e<=s.width()-t?n.addClass("d-none"):n.removeClass("d-none")}}])}(),l=function(){return s(function t(){e(this,t),this.mifidii=document.querySelector("#js-mifidii"),this.form=this.mifidii.querySelector(".js-mifidii-filters"),this.list=this.mifidii.querySelector(".js-mifidii-list"),this.listContent=this.mifidii.querySelector(".js-mifidii-list-content"),this.listLoader=this.mifidii.querySelector(".js-mifidii-list-loader"),this.welcomeBox=this.list.querySelector(".js-mifidii-welcome"),this.lowVolumeBox=this.list.querySelector(".js-mifidii-lowvolume"),this.instrumentLoader=this.mifidii.querySelector(".js-mifidii-instrument-loader"),this.instrumentText=this.mifidii.querySelector(".js-mifidii-instrument-text"),this.table=this.list.querySelector(".js-mifidii-table"),this.tableHeaderPassive=this.list.querySelector(".js-table-header-passive"),this.tableHeaderAggressive=this.list.querySelector(".js-table-header-aggressive"),this.filterForm=this.mifidii.querySelector(".js-mifidii-filters"),this.instrumentFilterDropdownObject=Forms.getFormElement(this.form.dataset.key,"instrumentClass"),this.instrumentFilterDropdownList=this.filterForm.querySelector(".js-sds-dropdown-item-list"),this.instrumentFilterInput=this.filterForm.querySelector('.js-instrument-filter input[name="instrumentClass"]'),this.formPdf=this.list.querySelector(".js-mifidii-form-pdf"),this.inputPdfDownload=this.formPdf.querySelector('input[name="pdfContent"]'),this.inputSelectedClientType=this.formPdf.querySelector('input[name="selectedClientType"]'),this.inputSelectedClientText=this.formPdf.querySelector('input[name="clientTypeText"]'),this.inputSelectedVenueType=this.formPdf.querySelector('input[name="selectedVenueType"]'),this.inputSelectedVenueText=this.formPdf.querySelector('input[name="venueTypeText"]'),this.inputInstrumentClassValue=this.formPdf.querySelector('input[name="selectedInstrumentClassValue"]'),this.inputInstrumentClassText=this.formPdf.querySelector('input[name="instrumentClassText"]'),this.downloadPdf=this.mifidii.querySelector(".js-mifidii-download-pdf"),this.generatePdf=this.mifidii.querySelector(".js-mifidii-generate-pdf "),this.attachLoadMore(),this.attachForms(),this.handlePdfDownload()},[{key:"handlePdfDownload",value:function(){var e=this;this.generatePdf.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),!1===e.generatePdf.classList.contains("-isLoading")&&(e.generatePdf.blur(),e.generatePdf.classList.add("-isLoading","-isDisabled"),Forms.submitForm(e.formPdf))})}},{key:"attachLoadMore",value:function(){this.listLoader.classList.add("d-none"),this.instrumentLoader.classList.add("d-none")}},{key:"loadInstrumentLinkContent",value:function(e){var t=this;e.endsWith("/")&&(e=e.slice(0,-1)),fetch(e+"?type=42069",{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"}).then(function(e){if(e.ok)return e.text();throw new Error("Something went wrong with the request")}).then(function(e){t.instrumentLoader.classList.add("d-none");var i=(new DOMParser).parseFromString(e,"text/html").getElementById("js-modal-content");i&&i.childNodes&&i.childNodes.length>0&&Array.from(i.childNodes).forEach(function(e){return t.instrumentText.append(e)}),t.instrumentText.classList.remove("d-none")}).catch(function(e){t.instrumentText.innerHTML="",t.instrumentText.classList.add("d-none"),t.instrumentLoader.classList.add("d-none"),console.log(e)})}},{key:"attachForms",value:function(){var e=this;Events.register(a.AJAX_FORM_RESPONDED,function(t){var i;switch(t.formKey){case"mifidii.pdf":t.response.data.pdfPath.length>0&&(e.generatePdf.classList.remove("-isLoading","-isDisabled"),e.generatePdf.classList.add("d-none"),e.downloadPdf.classList.remove("d-none"),e.downloadPdf.setAttribute("href",t.response.data.pdfPath));break;case"mifidii.filter":if(e.lowVolumeBox.classList.add("d-none"),(null===(i=t.response.data)||void 0===i||null===(i=i.instrumentClasses)||void 0===i?void 0:i.length)>0&&(e.renderInstrumentClassList(t.response.data,e.instrumentFilterDropdownList),e.instrumentFilterDropdownObject.reattachEvents()),""===e.instrumentFilterInput.value){e.welcomeBox.classList.remove("d-none"),e.table.classList.add("d-none"),e.formPdf.classList.add("d-none"),e.instrumentLoader.classList.add("d-none");break}e.inputInstrumentClassValue.value=e.instrumentFilterInput.value,e.inputInstrumentClassText.value=e.mifidii.querySelector(".js-sds-dropdown-selected-item .sds-advancedSelectItem__content P").innerHTML,e.inputSelectedClientType.value=e.filterForm.querySelector('INPUT[name="clientType"]:checked').value;var n=e.filterForm.querySelector('LABEL[for="'+e.filterForm.querySelector('INPUT[name="clientType"]:checked').id+'"]');e.inputSelectedClientText.value=n.innerHTML.trim(),e.inputSelectedVenueType.value=e.filterForm.querySelector('INPUT[name="venueType"]:checked').value;var s=e.filterForm.querySelector('LABEL[for="'+e.filterForm.querySelector('INPUT[name="venueType"]:checked').id+'"]');e.inputSelectedVenueText.value=s.innerHTML.trim(),e.formPdf.classList.remove("d-none"),t.response.data.datasets.length>0?(e.inputPdfDownload.value=JSON.stringify(t.response.data.datasets),e.renderFilteredList(t.response.data,e.listContent)):(e.inputPdfDownload.value="",e.lowVolumeBox.classList.remove("d-none"),e.table.classList.add("d-none")),t.response.data.link?e.loadInstrumentLinkContent(t.response.data.link):(e.instrumentText.innerHTML="",e.instrumentText.classList.add("d-none"),e.instrumentLoader.classList.add("d-none")),e.listLoader.classList.add("d-none"),new o}return!0}),Events.register(a.FORM_ELEMENT_CHANGED,function(t){switch(e.downloadPdf.setAttribute("href",""),e.downloadPdf.classList.add("d-none"),e.generatePdf.classList.remove("d-none","-isLoading","-isDisabled"),t.formKey){case"mifidii.filter":if(e.inputPdfDownload.value="",e.formPdf.classList.add("d-none"),"venueType"===t.name){var i=e.mifidii.querySelector('LABEL[for="'+t.name+"-"+t.value+'"]').innerHTML;e.formPdf.querySelector('INPUT[type="hidden"][name="'+t.name+'Value"]').value=i}else if("instrumentClass"===t.name){var n=e.mifidii.querySelector(".js-sds-dropdown-selected-item .sds-advancedSelectItem__content").innerHTML;e.formPdf.querySelector('INPUT[type="hidden"][name="'+t.name+'Value"]').value=$("<div />").text(n).innerHTML}else e.formPdf.querySelector('INPUT[type="hidden"][name="'+t.name+'Value"]').value=t.value;if(""==e.instrumentFilterInput.value){e.table.classList.add("d-none"),e.welcomeBox.classList.remove("d-none"),e.formPdf.classList.add("d-none");break}e.lowVolumeBox.classList.add("d-none"),e.table.classList.remove("d-none"),e.welcomeBox.classList.add("d-none"),e.listContent.innerHTML="",e.listLoader.classList.remove("d-none"),e.instrumentText.innerHTML="",e.instrumentText.classList.add("d-none"),e.instrumentLoader.classList.remove("d-none")}return!0});var t=$(".bcee-ab-filter"),i=$("#mifidiiFilterElements");i.on("hide.bs.collapse",function(){t.classList.remove("active")}),i.on("show.bs.collapse",function(){t.classList.add("active")})}},{key:"isVenueFilterValueMarket",value:function(){return"Y"===this.filterForm.querySelector('INPUT[name="venueType"]:checked').value}},{key:"renderInstrumentClassList",value:function(e,t){if(t.innerHTML="",e.instrumentClasses[1]){var i,n=e.instrumentClasses[0],s=e.instrumentClasses[1];for(var a in s){var o=s[a],l=this.renderInstrumentClassItem(o,n);t.appendChild(l)}if(null!==(i=t.querySelector('BUTTON[data-value="'+this.instrumentFilterInput.value+'"]'))&&void 0!==i&&i.getAttribute("disabled")){this.instrumentFilterInput.value="";var d=r("DIV",{class:"sds-advancedSelectItem__content"},[r("P",{},this.mifidii.querySelector(".js-mifidii-instrument-filter-placeholder").innerHTML)]);document.querySelector(".js-sds-dropdown-selected-item").replaceChildren(d)}}}},{key:"renderInstrumentClassItem",value:function(e,t){var i={type:"button",class:"sds-advancedSelectItem js-sds-dropdown-item","data-value":e.code};return"1"==e.disabled?i.disabled="disabled":e.code==t&&" dot-selected",r("LI",{},[r("DIV",{class:"sds-outOfBounds"},[r("BUTTON",i,[r("DIV",{class:"sds-advancedSelectItem__content"},[r("P",{},e.primary),r("P",{class:"sds-advancedSelectItem__meta sds-textHelper"},e.secondary)]),r("SPAN",{class:"sds-advancedSelectItem__icon sds-icon sds-icon-chevrondown d-none js-form-select-dropdown-chevron","aria-hidden":"true"})])])])}},{key:"renderFilteredList",value:function(e,t){for(var i=e.datasets,n=0;n<i.length;n++){var s=i[n],r=this.renderMifidiiItem(s,e.translations,e.snetLink);t.appendChild(r)}this.isVenueFilterValueMarket()?(this.tableHeaderPassive.classList.remove("d-none"),this.tableHeaderAggressive.classList.remove("d-none")):(this.tableHeaderAggressive.classList.add("d-none"),this.tableHeaderPassive.classList.add("d-none"))}},{key:"renderMifidiiItem",value:function(e,t,i){var n="",s="";return this.isVenueFilterValueMarket()&&(n=r("TD",{class:"list-item-col"},[e["Percentage Passive"]+"%"]),s=r("TD",{class:"list-item-col"},[e["Percentage Aggressive"]+"%"])),r("TR",{class:"filtered-list-item"},[r("TD",{class:"list-item-col rank"},[e.Rank]),r("TD",{class:"list-item-col venue"},[r("div",{class:"name"},[e["Venue Name"]]),r("div",{class:"identifier"},[e["Venue Identifier"]])]),r("TD",{class:"list-item-col"},[e["Percentage Of Volume"]+"%"]),r("TD",{class:"list-item-col"},[e["Percentage Of Orders"]+"%"]),n,s,r("TD",{class:"list-item-col"},[e["Percentage Directed"]+"%"])])}}])}();Events.register(a.WINDOW_LOADED,function(){return new l,!0})})();